---
- name: Install Ansible repository keys
  apt_key:
    keyserver: 'keyserver.ubuntu.com'
    id: '93C4A3FD7BB9C367'
    state: 'present'
  become: True
  register: res
  until: res is success
  retries: 3
- name: Install Ansible repository
  apt_repository:
    repo: 'deb http://ppa.launchpad.net/ansible/ansible/ubuntu trusty main'
    state: 'present'
    mode: 0644
  become: True
  register: res
  until: res is success
  retries: 3
- name: Install Ansible package
  package:
    name: 'ansible'
    state: 'present'
  become: True
  register: res
  until: res is success
  retries: 3
- name: Configure satnogs-setup
  template:
    src: 'etc/default/satnogs-setup.j2'
    dest: '/etc/default/satnogs-setup'
    mode: 0644
  become: True
  tags:
    - config
- name: Set up inventory
  copy:
    src: 'etc/ansible/hosts'
    dest: '/etc/ansible/hosts'
    mode: 0644
  become: True
- name: Create host variables directory
  file:
    path: '/etc/ansible/host_vars'
    state: 'directory'
    mode: 0755
  become: True
- name: Create host variables file
  file:
    path: '/etc/ansible/host_vars/localhost'
    state: 'touch'
    mode: 0644
  become: True
- name: Create satnogs-setup share directory
  file:
    path: '/usr/local/share/satnogs-setup'
    state: 'directory'
    mode: 0755
  become: True
- name: Install satnogs-setup scripts
  copy:
    src: '{{ item.0 }}'
    dest: '{{ item.1 }}'
    mode: 0755
  become: True
  with_together:
    - [ 'usr/local/bin/satnogs-setup', 'usr/local/share/satnogs-setup/bootstrap.sh',
    'usr/local/share/satnogs-setup/setup.sh', 'usr/local/share/satnogs-setup/config.sh' ]
    - [ '/usr/local/bin/satnogs-setup', '/usr/local/share/satnogs-setup/bootstrap.sh',
    '/usr/local/share/satnogs-setup/setup.sh', '/usr/local/share/satnogs-setup/config.sh' ]
